#{extends 'client.html' /}
#{set title:'胎动分析' /}
#{set 'moreStyles'}
<link href="@{'/public/stylesheets/client/pregDetai.css'}?v=20150531" rel="stylesheet" />
<link href="@{'/public/stylesheets/client/mobiscroll/mobiscroll.scroller.css'}" rel="stylesheet" type="text/css" />
<link href="@{'/public/stylesheets/client/mobiscroll/mobiscroll.animation.css'}" rel="stylesheet" type="text/css" />
<link href="@{'/public/stylesheets/client/mobiscroll/mobiscroll.frame.css'}" rel="stylesheet" type="text/css" />
#{/set}
#{output 'Client/record/pregDetailTpl.html'/}

<!-- 网页首部 -->
<header class="mui-bar mui-bar-nav client-bar-nav">
	<a class="mui-icon mui-icon-left-nav mui-pull-left" href="/"></a>
	<h1 class="mui-title client-title">胎动分析</h1>
</header>

<!-- 日期选择 -->


<!-- 选项卡 -->
<div class="mui-content">
	<div id="slider" class="mui-slider">
	<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
		<a class="mui-control-item active" href="#menseItem">胎动纪录</a>
		<a class="mui-control-item" href="#menseChart">图表统计</a>
	</div>
	<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6 negative"></div>
	<div class="mui-slider-group">
		<div id="menseItem" class="mui-slider-item mui-control-content mui-active">
			<!--input type="text" placeholder="开始日期" id="menseStartDate" class="dateInput"/>
			<input type="text" placeholder="结束日期" id="menseEndDate" class="dateInput"/>
			<button class="mui-btn mui-btn-block mui-btn-outlined">查找</button-->
				<table class="preg-record-table" id="tempTable">
				<thead>
					<tr>
						<th>记录日期</th>
						<th>胎动(次数)</th>
					</tr>
				</thead>
				<tbody>
					
				</tbody>
			</table>
		</div>
		<div id="menseChart" class="mui-slider-item mui-control-content">
			<!--input type="text" placeholder="开始日期" id="menseChartStartDate" class="dateInput"/>
			<input type="text" placeholder="结束日期" id="menseChartEndDate" class="dateInput"/>
			<button class="mui-btn mui-btn-block mui-btn-outlined">统计</button-->
			<canvas id="mense-chart" class="preg-chart"></canvas>
			<div class="mense-chart-empty chart-empty not-shown">图表无数据显示</div>
		</div>
	</div>
</div>
</div>

#{set 'moreScripts'}
<script type="text/javascript" charset="utf-8">mui.init();</script>
<script src="@{'/public/javascripts/client/jquery-1.9.1.min.js'}"></script>
<script type="text/javascript" src = "@{'/public/javascripts/juicer.js'}"></script>
<script src="@{'/public/javascripts/client/mobiscroll/mobiscroll.core.js'}"></script>
<script src="@{'/public/javascripts/client/mobiscroll/mobiscroll.frame.js'}"></script>
<script src="@{'/public/javascripts/client/mobiscroll/mobiscroll.scroller.js'}"></script>
<script src="@{'/public/javascripts/client/mobiscroll/mobiscroll.util.datetime.js'}"></script>
<script src="@{'/public/javascripts/client/mobiscroll/mobiscroll.datetimebase.js'}"></script>
<script src="@{'/public/javascripts/client/mobiscroll/mobiscroll.datetime.js'}"></script>
<script src="@{'/public/javascripts/client/mobiscroll/i18n/mobiscroll.i18n.zh.js'}"></script>
<script src="@{'/public/javascripts/client/Chart.min.js'}" type="text/javascript"></script>
<script type="text/javascript">
	$(function(){
		$('#menseStartDate').mobiscroll().date({
            theme: 'mobiscroll',
            display: 'bottom',
            lang: 'zh',
            onSelect: function(valueText, inst) {
                var selectedDate = inst.getVal(); // Call the getVal method
                var date = $.mobiscroll.datetime.formatDate('yy-mm-dd', selectedDate);
                // $('#pregw-date-val').attr('data-val', date);
           		$('#menseStartDate').val(date);
            }
        });
        $('#menseEndDate').mobiscroll().date({
            theme: 'mobiscroll',
            display: 'bottom',
            lang: 'zh',
            onSelect: function(valueText, inst) {
                var selectedDate = inst.getVal(); // Call the getVal method
                var date = $.mobiscroll.datetime.formatDate('yy-mm-dd', selectedDate);
                // $('#pregw-date-val').attr('data-val', date);
           		$('#menseStartDate').val(date);
            }
        });
        $('#menseChartStartDate').mobiscroll().date({
            theme: 'mobiscroll',
            display: 'bottom',
            lang: 'zh',
            onSelect: function(valueText, inst) {
                var selectedDate = inst.getVal(); // Call the getVal method
                var date = $.mobiscroll.datetime.formatDate('yy-mm-dd', selectedDate);
                // $('#pregw-date-val').attr('data-val', date);
           		$('#menseChartStartDate').val(date);
            }
        });
        $('#menseChartEndDate').mobiscroll().date({
            theme: 'mobiscroll',
            display: 'bottom',
            lang: 'zh',
            onSelect: function(valueText, inst) {
                var selectedDate = inst.getVal(); // Call the getVal method
                var date = $.mobiscroll.datetime.formatDate('yy-mm-dd', selectedDate);
                // $('#pregw-date-val').attr('data-val', date);
           		$('#menseChartEndDate').val(date);
            }
        });
        
        $.get('/CMove/loadAllMovement',function(data){
        	console.log(data);
        	var html = "";
        	if(data.data.length == 0){
        		html = "<tr class='tr-even'><td>无记录</td><td>无记录</td></tr>";
        	}
        	else{
				for(var i=0;i<data.data.length;i++){
					html+="<tr class='tr-even'><td>"+data.data[i].dateStr+"</td><td>"+data.data[i].num+"</td></tr>";
				}
        	}
        	$('#tempTable tbody').html(html);
        });

        var dataList,labelList;

        var item2Show = false;//子选项卡是否显示标志
        document.querySelector('.mui-slider').addEventListener('slide', function(event) {
          if (event.detail.slideNumber === 1&&!item2Show) {
            console.log("come in 2");
            $.get('/CMove/loadAllMovementChart',function(data){
                    dataList = data.data.data;
                    labelList = data.data.label;
                    if(dataList.length != 0){
                        var loadMenseChart = function() {
                            $(".preg-chart").attr("width", $(window).get(0).innerWidth * 0.95);
                            $(".preg-chart").attr("height", "150");
                            var ctx = $("#mense-chart").get(0).getContext("2d");
                            var options = {
                                animation: false
                            };
                            var data = {
                                labels: labelList,
                                datasets: [{
                                    fillColor: "rgba(242,195,195,0.4)",
                                    strokeColor: "rgba(223,116,116,0.4)",
                                    pointColor: "rgba(223,116,116,0.4)",
                                    pointStrokeColor: "#fff",
                                    data: dataList
                                }]
                            }
                            //new Chart(ctx).Line(data, options);
                            new Chart(ctx).Bar(data,null);
                        };
                        loadMenseChart();
                        $('.mense-chart-empty').addClass('not-shown');
                    }
                    else{
                        $('.mense-chart-empty').removeClass('not-shown');
                    }
                }); 
            //改变标志位，下次直接显示
            item2Show = true;
          } 
        });
        
	})
</script>
#{/set}
